<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=480; user-scalable=no" />
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>The Placemarker App</title>
		<link rel="stylesheet" href="master.css" type="text/css" media="screen" title="no title" charset="utf-8">
		<script type="text/javascript" charset="utf-8" src="jquery.js"></script>
		<script type="text/javascript" charset="utf-8" src="jquery.json.js"></script>
		
		<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
	
	<script type="text/javascript" charset="utf-8">
		var watchID = null;
		  
	    var getLocation = function(mode) {
	    	//var loc_des = prompt("Location description", "");
	    	//showMap($('#theMapView'),'mode=save&loc_des='+ loc_des +'&mobileApp=true&ll=10.7702,106.708338');
	      var suc = function(p){
			    //alert(p.coords.latitude + " " + p.coords.longitude);
			    var ll = p.coords.latitude + "," + p.coords.longitude;
			    if(mode == "save") {
			    	var loc_des = prompt("Location description", "");
			    	showMap($('#theMapView'),'mode=save&loc_des='+ loc_des +'&mobileApp=true&ll=' + ll);
			    } else {
			    	showMap($('#theMapView'),'mobileApp=true&ll=' + ll);
			    }
	      };
	      var fail = function(){ alert('getCurrentPosition failed!');};
	      navigator.geolocation.getCurrentPosition(suc,fail,{enableHighAccuracy:true});
	    }

	    function mapLoaded(node) {
		    
	    }
	
		function showMap(node,params){
			var map_url = "http://drd-vn-database.com/mobile/v_map_mobile.html?" + params;
			$(node).attr('src',map_url).show();
		}

	    // PhoneGap is ready
	    //
	    function onDeviceReady() {
	    	showMap($('#theMapView'),'mobileApp=true');
	        var options = { frequency: 5000 , enableHighAccuracy:true};  // Update every 5 seconds
	        watchID = navigator.geolocation.watchPosition(onwWatchPositionSuccess, onwWatchPositionError, options);
	    }

	    function onLocationChanged(latitude, longitude ) {
	        var element = document.getElementById('geolocation');
	        element.innerHTML = 'LocationChanged, Latitude: '  + latitude + ', ' + 'Longitude: ' + longitude + '<hr />';
	    }

	    function onwWatchPositionSuccess(position) {
	        var element = document.getElementById('geolocation');
	        element.innerHTML = 'Latitude: '  + position.coords.latitude + ', Longitude: ' + position.coords.longitude + '<hr />';
	    }

	    function onwWatchPositionError(error) {
	    	// onError Callback receives a PositionError object
	        alert('code: '    + error.code    + '\n' +
	              'message: ' + error.message + '\n');
	    }
				
		function onLoad(){
			document.addEventListener("deviceready", onDeviceReady, false);
		}
	  </script>
	</head>
	<body onload="onLoad();" id="stage" class="theme">
		<h4>Welcome to The Placemarker App!</h4>
		<p id="geolocation">Watching geolocation...</p>
		<a href="#" class="btn " onclick="getLocation('read');">Get My Location</a>
		<a href="#" class="btn " onclick="getLocation('save');">Save My Location</a>
		<hr />
		<iframe onload="mapLoaded(this)" id="theMapView" style="display: none;margin-top: 20px;width:97%" height="600" src="" ></iframe>
	
	</body>
</html>
